<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <data>
        <!-- Direct injection into POS Receipt Screen -->
        <template id="pos_sms_direct_inject" inherit_id="point_of_sale.ReceiptScreen" name="POS SMS Direct Injection">
            <xpath expr="//head" position="inside">
                <script type="text/javascript">
                    console.log('ðŸš€ðŸš€ðŸš€ POS SMS RECEIPT SCREEN INJECTION LOADING ðŸš€ðŸš€ðŸš€');
                    alert('SMS Template Loading on Receipt Screen!');
                    
                    // Function to add SMS section
                    function addPosSmsSection() {
                        if (document.querySelector('#pos-sms-section')) {
                            return;
                        }
                        
                        // Look for email input
                        const emailInput = document.querySelector('input[type="email"]');
                        if (!emailInput) {
                            return;
                        }
                        
                        console.log('âœ… Adding SMS section to POS');
                        
                        // Find email container
                        let emailContainer = emailInput.closest('div');
                        while (emailContainer && !emailContainer.querySelector('button')) {
                            emailContainer = emailContainer.parentElement;
                        }
                        
                        if (emailContainer) {
                            // Create SMS section
                            const smsSection = document.createElement('div');
                            smsSection.id = 'pos-sms-section';
                            smsSection.style.cssText = 'margin-top: 10px; display: flex; align-items: center; gap: 10px; padding: 8px; background: #fff3cd; border: 1px solid #ffeaa7; border-radius: 4px;';
                            
                            // SMS label
                            const label = document.createElement('strong');
                            label.textContent = 'SMS:';
                            label.style.cssText = 'color: #856404; min-width: 35px;';
                            
                            // Phone input
                            const phoneInput = document.createElement('input');
                            phoneInput.type = 'tel';
                            phoneInput.placeholder = 'Phone number for SMS receipt';
                            phoneInput.style.cssText = 'flex: 1; padding: 8px 12px; border: 1px solid #ddd; border-radius: 4px; font-size: 14px;';
                            
                            // SMS button
                            const smsButton = document.createElement('button');
                            smsButton.innerHTML = 'ðŸ“±';
                            smsButton.title = 'Send SMS Receipt';
                            smsButton.style.cssText = 'background: #875A7B; color: white; border: none; padding: 8px 12px; border-radius: 4px; cursor: pointer; font-size: 16px; min-width: 40px; height: 36px;';
                            
                            // SMS functionality
                            smsButton.onclick = function() {
                                const phone = phoneInput.value.trim();
                                if (!phone) {
                                    alert('Please enter a phone number');
                                    return;
                                }
                                
                                smsButton.innerHTML = 'â³';
                                smsButton.disabled = true;
                                
                                fetch('/pos_sms_receipt/send_sms', {
                                    method: 'POST',
                                    headers: { 'Content-Type': 'application/json' },
                                    body: JSON.stringify({
                                        jsonrpc: '2.0',
                                        method: 'call',
                                        params: { phone: phone, order_id: null },
                                        id: Math.floor(Math.random() * 1000000)
                                    })
                                })
                                .then(response => response.json())
                                .then(data => {
                                    const result = data.result || data;
                                    if (result.success) {
                                        alert('âœ… SMS sent to ' + phone);
                                    } else {
                                        alert('âŒ Failed: ' + (result.error || 'Unknown error'));
                                    }
                                })
                                .catch(error => {
                                    alert('âŒ Error: ' + error.message);
                                })
                                .finally(() => {
                                    smsButton.innerHTML = 'ðŸ“±';
                                    smsButton.disabled = false;
                                });
                            };
                            
                            // Assemble
                            smsSection.appendChild(label);
                            smsSection.appendChild(phoneInput);
                            smsSection.appendChild(smsButton);
                            
                            // Insert
                            emailContainer.parentNode.insertBefore(smsSection, emailContainer.nextSibling);
                            
                            console.log('âœ… SMS section added to POS');
                        }
                    }
                    
                    // Try multiple times
                    setTimeout(addPosSmsSection, 1000);
                    setTimeout(addPosSmsSection, 2000);
                    setTimeout(addPosSmsSection, 3000);
                    setTimeout(addPosSmsSection, 5000);
                    setTimeout(addPosSmsSection, 10000);
                    
                    // Monitor for changes
                    const observer = new MutationObserver(() => {
                        setTimeout(addPosSmsSection, 500);
                    });
                    
                    // Start observing when ready
                    if (document.body) {
                        observer.observe(document.body, { childList: true, subtree: true });
                    } else {
                        document.addEventListener('DOMContentLoaded', () => {
                            observer.observe(document.body, { childList: true, subtree: true });
                        });
                    }
                    
                    console.log('ðŸ“± POS SMS Direct Injection Initialized');
                </script>
            </xpath>
        </template>
    </data>
</odoo>